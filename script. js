// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ÙˆØ§Ù„ÙØ±Ù†Ø³ÙŠØ©
function updateTime() {
  const now = new Date();
  const daysAr = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
  const daysFr = ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'];
  const monthsAr = ['Ø¬Ø§Ù†ÙÙŠ', 'ÙÙŠÙØ±ÙŠ', 'Ù…Ø§Ø±Ø³', 'Ø£ÙØ±ÙŠÙ„', 'Ù…Ø§ÙŠ', 'Ø¬ÙˆØ§Ù†', 'Ø¬ÙˆÙŠÙ„ÙŠØ©', 'Ø£ÙˆØª', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  const monthsFr = ['janvier', 'fÃ©vrier', 'mars', 'avril', 'mai', 'juin', 'juillet', 'aoÃ»t', 'septembre', 'octobre', 'novembre', 'dÃ©cembre'];

  const lang = localStorage.getItem('lang') || 'ar';

  const dayName = lang === 'ar' ? daysAr[now.getDay()] : daysFr[now.getDay()];
  const monthName = lang === 'ar' ? monthsAr[now.getMonth()] : monthsFr[now.getMonth()];
  const date = now.getDate();
  const hours = now.getHours().toString().padStart(2,'0');
  const minutes = now.getMinutes().toString().padStart(2,'0');

  const timeString = lang === 'ar' ?
    `${dayName} ${date} ${monthName} - ${hours}:${minutes}` :
    `${dayName} ${date} ${monthName} - ${hours}h${minutes}`;

  document.getElementById('current-time').textContent = timeString;
}

// Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
function updateVisits() {
  let visits = localStorage.getItem('visit-count');
  visits = visits ? parseInt(visits) + 1 : 1;
  localStorage.setItem('visit-count', visits);
  const lang = localStorage.getItem('lang') || 'ar';
  const text = lang === 'ar' ? `Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${visits}` : `Visites: ${visits}`;
  document.getElementById('visit-count').textContent = text;
}

// Ø¬Ù„Ø¨ Ø£Ø®Ø¨Ø§Ø± BBC Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ø¯Ø¹Ù… Ø§Ù„Ù„ØºØ©
function fetchNews() {
  fetch('https://api.rss2json.com/v1/api.json?rss_url=http://feeds.bbci.co.uk/arabic/rss.xml')
    .then(res => res.json())
    .then(data => {
      const items = data.items.slice(0, 4);
      const lang = localStorage.getItem('lang') || 'ar';
      const newsText = items.map(item => `ðŸ“° ${item.title}`).join(' âš¡ ');
      document.getElementById('live-news').textContent = newsText;
    })
    .catch(() => {
      const lang = localStorage.getItem('lang') || 'ar';
      document.getElementById('live-news').textContent = lang === 'ar' ? 'âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±.' : 'âŒ Ã‰chec du chargement des actualitÃ©s.';
    });
}

// ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© (Ø¹Ø±Ø¨ÙŠ / ÙØ±Ù†Ø³ÙŠ)
function toggleLang() {
  let currentLang = localStorage.getItem('lang') || 'ar';
  let newLang = currentLang === 'ar' ? 'fr' : 'ar';
  localStorage.setItem('lang', newLang);
  applyLang();
}

function applyLang() {
  let lang = localStorage.getItem('lang') || 'ar';
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
  document.querySelector('.lang-toggle').textContent = lang === 'ar' ? 'FranÃ§ais' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';

  // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©
  document.querySelectorAll('.t').forEach(el => {
    el.textContent = el.dataset[lang];
  });

  // Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  const titles = {
    'title-services': {'ar': 'Ø®Ø¯Ù…Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©', 'fr': 'Nos Services'},
    'title-photos': {'ar': 'ðŸ“¸ Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±', 'fr': 'ðŸ“¸ Galerie photos'},
    'title-videos': {'ar': 'ðŸŽ¥ ÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©', 'fr': 'ðŸŽ¥ VidÃ©os de l\'atelier'},
    'title-home': {'ar': 'Atelier Electronique MÃ©denine', 'fr': 'Atelier Electronique MÃ©denine'}
  };

  Object.keys(titles).forEach(id => {
    const el = document.getElementById(id);
    if(el) el.textContent = titles[id][lang];
  });

  // Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø®Ø¨Ø§Ø±
  fetchNews();

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø²ÙŠØ§Ø±Ø§Øª
  updateTime();
  updateVisits();
}

// ØªÙ†ÙÙŠØ° Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
window.onload = () => {
  applyLang();
  setInterval(updateTime, 60000);
};
