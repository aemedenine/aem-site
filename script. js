document.addEventListener('DOMContentLoaded', () => {
  let currentLang = 'ar';

  // تحديث الوقت الحالي
  function updateTime() {
    const now = new Date();
    const timeElem = document.getElementById('current-time');
    if (!timeElem) return;
    // صيغة الوقت بالعربية أو الفرنسية
    const options = {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
    };
    timeElem.textContent = now.toLocaleTimeString(currentLang === 'ar' ? 'ar-TN' : 'fr-FR', options);
  }

  // تحديث عدد الزيارات (مثال وهمي)
  function updateVisits() {
    const visitsElem = document.getElementById('visit-count');
    if (!visitsElem) return;
    // هنا ممكن تربط مع عداد حقيقي أو تحط عدد وهمي
    let visits = localStorage.getItem('visit-count') || 0;
    visits = parseInt(visits) + 1;
    localStorage.setItem('visit-count', visits);
    visitsElem.textContent = visits;
  }

  // الأخبار الحية (مثال وهمي)
  async function fetchNews() {
    try {
      const news = [
        "📢 ورشة إلكترونيك الرحماني تفتح أبوابها لجميع الولايات.",
        "🔧 خدمات تصليح الأجهزة الإلكترونية بجودة عالية وبأسعار منافسة.",
        "🌍 التوصيل عبر البريد متوفر لكل أنحاء تونس.",
        "📱 تواصل معنا عبر واتساب لأي استفسار."
      ];
      const liveNewsElem = document.getElementById('live-news');
      if (liveNewsElem) {
        liveNewsElem.textContent = news.join('  •  ');
      }
    } catch (e) {
      const liveNewsElem = document.getElementById('live-news');
      if (liveNewsElem) liveNewsElem.textContent = 'تعذر تحميل الأخبار حالياً.';
    }
  }

  // تبديل اللغة عربي/فرنسي
  const experienceBadge = document.querySelector('.experience-badge');
  const radio = document.getElementById('radio-stream');
  const radioBtn = document.getElementById('radio-btn');

  window.toggleLanguage = function() {
    if (currentLang === 'ar') {
      document.documentElement.lang = 'fr';
      currentLang = 'fr';

      document.querySelector('header h1').textContent = "Atelier Electronique Médenine";
      const qrLabel = document.getElementById('qr-label');
      if (qrLabel) qrLabel.textContent = "📱 Scannez pour accès rapide";
      if (experienceBadge) experienceBadge.textContent = "🌼 Plus de 10 ans d'expérience";
      const slogan = document.getElementById('slogan');
      if (slogan) slogan.textContent = "Atelier Electronique Médenine - Service dans toute la Tunisie";
      const whatsappBtn = document.getElementById('whatsapp-btn');
      if (whatsappBtn) whatsappBtn.textContent = "📞 Contactez-nous WhatsApp";
      const mapsBtn = document.getElementById('maps-btn');
      if (mapsBtn) mapsBtn.textContent = "🗺️ Voir sur Google Maps";
      const photosBtn = document.querySelector('.photos');
      if (photosBtn) photosBtn.textContent = "📷 Voir les photos";
      const videosBtn = document.querySelector('.videos');
      if (videosBtn) videosBtn.textContent = "🎞️ Voir les vidéos";
      if (radioBtn && radio) radioBtn.textContent = radio.paused ? "📻 Écouter la radio" : "⏸️ Arrêter la radio";
      const specialBtn = document.querySelector('.special-service-btn');
      if (specialBtn) specialBtn.textContent = "🛠️ Services de l'atelier";

      // الأسئلة الشائعة بالفرنسية
      const faqs = [
        { q: "Comment puis-je envoyer un appareil pour réparation ?", a: "Vous pouvez envoyer l'appareil par courrier à l'atelier ou nous contacter pour organiser la collecte." },
        { q: "Quel est le délai moyen de réparation ?", a: "Le délai dépend du type de panne, mais généralement pas plus de 3 jours ouvrables." },
        { q: "Fournissez-vous des pièces d'origine ?", a: "Oui, nous fournissons des pièces d'origine et de haute qualité pour tous les appareils." },
        { q: "Comment suivre l'état de la réparation ?", a: "Nous envoyons des photos et vidéos de l'état de l'appareil pendant la réparation via WhatsApp." }
      ];
      const faqContainer = document.querySelector('.faq');
      if (faqContainer) {
        faqContainer.innerHTML = '<h2>FAQ</h2>';
        faqs.forEach(item => {
          const faqItem = document.createElement('div');
          faqItem.classList.add('faq-item');
          faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
          faqContainer.appendChild(faqItem);
        });
        // فعاليات الفتح/الغلق للأسئلة
        faqContainer.querySelectorAll('.faq-item h3').forEach(h3 => {
          h3.addEventListener('click', () => {
            h3.parentElement.classList.toggle('open');
          });
        });
      }

      // ترجمة الفوتر
      const footerText = document.getElementById('footer-text');
      if (footerText) {
        footerText.innerHTML = `
          📍 Médenine – Service dans toute la Tunisie | 📲 WhatsApp: 98192103<br>
          ⏰ Du lundi au samedi, 08:00 - 18:00 | Dimanche fermé
          <div class="social-icons">
            <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
              <img src="icons/facebook.svg" alt="Facebook" />
            </a>
            <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
              <img src="icons/instagram.svg" alt="Instagram" />
            </a>
            <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
              <img src="icons/whatsapp.svg" alt="WhatsApp" />
            </a>
          </div>
        `;
      }
    } else {
      // عربي
      document.documentElement.lang = 'ar';
      currentLang = 'ar';

      document.querySelector('header h1').textContent = "Atelier Electronique Médenine";
      const qrLabel = document.getElementById('qr-label');
      if (qrLabel) qrLabel.textContent = "📱 امسح للوصول السريع";
      if (experienceBadge) experienceBadge.textContent = "🌼 10+ سنوات خبرة";
      const slogan = document.getElementById('slogan');
      if (slogan) slogan.textContent = "ورشة إلكترونيك الرحماني - نخدمو تونس الكل";
      const whatsappBtn = document.getElementById('whatsapp-btn');
      if (whatsappBtn) whatsappBtn.textContent = "📞 تواصل معنا واتساب";
      const mapsBtn = document.getElementById('maps-btn');
      if (mapsBtn) mapsBtn.textContent = "🗺️ شوفنا على Google Maps";
      const photosBtn = document.querySelector('.photos');
      if (photosBtn) photosBtn.textContent = "📷 شوف الصور";
      const videosBtn = document.querySelector('.videos');
      if (videosBtn) videosBtn.textContent = "🎞️ شوف الفيديو";
      if (radioBtn && radio) radioBtn.textContent = radio.paused ? "📻 شغّل الراديو" : "⏸️ أوقف الراديو";
      const specialBtn = document.querySelector('.special-service-btn');
      if (specialBtn) specialBtn.textContent = "🛠️ خدمات الورشة";

      const faqsAr = [
        { q: "كيف يمكنني إرسال جهاز للإصلاح؟", a: "يمكنك إرسال الجهاز عبر البريد إلى عنوان الورشة أو التواصل معنا لترتيب خدمة الاستلام." },
        { q: "ما هي مدة التصليح المعتادة؟", a: "مدة التصليح تختلف حسب نوع العطل، لكن غالباً لا تتجاوز 3 أيام عمل." },
        { q: "هل توفرون قطع غيار أصلية؟", a: "نعم، نوفر قطع غيار أصلية وذات جودة عالية لجميع الأجهزة." },
        { q: "كيف أتابع حالة الإصلاح؟", a: "نقوم بإرسال صور وفيديوهات لحالة الجهاز أثناء مراحل التصليح عبر واتساب." }
      ];
      const faqContainer = document.querySelector('.faq');
      if (faqContainer) {
        faqContainer.innerHTML = '<h2>الأسئلة الشائعة</h2>';
        faqsAr.forEach(item => {
          const faqItem = document.createElement('div');
          faqItem.classList.add('faq-item');
          faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
          faqContainer.appendChild(faqItem);
        });
        faqContainer.querySelectorAll('.faq-item h3').forEach(h3 => {
          h3.addEventListener('click', () => {
            h3.parentElement.classList.toggle('open');
          });
        });
      }

      // ترجمة الفوتر
      const footerText = document.getElementById('footer-text');
      if (footerText) {
        footerText.innerHTML = `
          📍 مدنين – نخدمو في كامل أنحاء تونس | 📲 WhatsApp:98192103<br>
          ⏰ من الإثنين للسبت، 08:00 - 18:00 | الأحد راحة
          <div class="social-icons">
            <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
              <img src="icons/facebook.svg" alt="Facebook" />
            </a>
            <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
              <img src="icons/instagram.svg" alt="Instagram" />
            </a>
            <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
              <img src="icons/whatsapp.svg" alt="WhatsApp" />
            </a>
          </div>
        `;
      }
    }
  };

  // تحديث الوقت وعدد الزيارات
  updateTime();
  updateVisits();
  fetchNews();

  setInterval(updateTime, 1000 * 60); // تحديث كل دقيقة

  // اللايتبوكس للصور
  window.openLightbox = function(src) {
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    if (lightbox && lightboxImg) {
      lightboxImg.src = src;
      lightbox.style.display = 'flex';
    }
  };
  window.closeLightbox = function() {
    const lightbox = document.getElementById('lightbox');
    if (lightbox) lightbox.style.display = 'none';
  };

  // تفاعل (لايك، حب، تصفيق)
  window.addReaction = function(mediaId, reaction) {
    alert(`شكراً على تفاعلك ${reaction} للصورة/الفيديو رقم ${mediaId}`);
  };

  // إضافة تعليق
  window.addComment = function(mediaId) {
    const textarea = document.getElementById(`comment-input-${mediaId}`);
    if (!textarea) return;
    const commentText = textarea.value.trim();
    if (!commentText) {
      alert('الرجاء كتابة تعليق قبل الإرسال');
      return;
    }
    const commentsList = document.getElementById(`comments-${mediaId}`);
    if (!commentsList) return;
    const newComment = document.createElement('div');
    newComment.classList.add('comment');
    newComment.textContent = commentText;
    commentsList.appendChild(newComment);
    textarea.value = '';
  };

  // راديو
  const radioStream = document.getElementById('radio-stream');
  if (radioStream) {
    const radioButton = document.getElementById('radio-btn');
    if (radioButton) {
      radioButton.addEventListener('click', () => {
        if (radioStream.paused) {
          radioStream.play();
          radioButton.textContent = currentLang === 'ar' ? "⏸️ أوقف الراديو" : "⏸️ Arrêter la radio";
        } else {
          radioStream.pause();
          radioButton.textContent = currentLang === 'ar' ? "📻 شغّل الراديو" : "📻 Écouter la radio";
        }
      });
    }
  }
});
