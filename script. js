const videoList = document.getElementById('video-list');
const mainVideo = document.getElementById('main-video');
const commentsList = document.getElementById('comments-list');
const commentInput = document.getElementById('comment-input');
const addCommentBtn = document.getElementById('add-comment-btn');
const reactionButtons = document.querySelectorAll('.reactions button');

let currentVideoId = 'video1';

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù…Ù† localStorage
function loadData() {
  const reactionsData = JSON.parse(localStorage.getItem('videoReactions')) || {};
  const commentsData = JSON.parse(localStorage.getItem('videoComments')) || {};

  // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„Ù„ÙÙŠØ¯ÙŠÙˆ Ø§Ù„Ø­Ø§Ù„ÙŠ
  displayComments(commentsData[currentVideoId] || []);

  // ØªÙ‡ÙŠØ¦Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø¹Ø¯Ø¯ Ø§Ù„Ø£ØµÙˆØ§Øª
  reactionButtons.forEach(btn => {
    const reaction = btn.getAttribute('data-reaction');
    const count = reactionsData[currentVideoId]?.[reaction] || 0;
    if (reaction === 'like') btn.textContent = `â¤ï¸ ${count}`;
    else if (reaction === 'love') btn.textContent = `ğŸ˜ ${count}`;
    else if (reaction === 'laugh') btn.textContent = `ğŸ˜‚ ${count}`;
  });
}

// Ø­ÙØ¸ Ø§Ù„ØªÙØ§Ø¹Ù„Ø§Øª ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙÙŠ localStorage
function saveData(reactionsData, commentsData) {
  localStorage.setItem('videoReactions', JSON.stringify(reactionsData));
  localStorage.setItem('videoComments', JSON.stringify(commentsData));
}

// Ø¹Ø±Ø¶ Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
function displayComments(comments) {
  commentsList.innerHTML = '';
  if (comments.length === 0) {
    commentsList.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</p>';
    return;
  }
  comments.forEach(comment => {
    const div = document.createElement('div');
    div.className = 'comment';
    div.textContent = comment;
    commentsList.appendChild(div);
  });
}

// ØªØºÙŠÙŠØ± Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø¹Ù†ØµØ± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
videoList.addEventListener('click', e => {
  let item = e.target;
  while (item && !item.classList.contains('video-item')) {
    item = item.parentElement;
  }
  if (!item) return;
  if (item.classList.contains('active')) return; // Ù†ÙØ³ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ

  const src = item.getAttribute('data-src');
  const poster = item.getAttribute('data-poster');
  const videoId = item.getAttribute('data-id');

  mainVideo.src = src;
  mainVideo.poster = poster;
  mainVideo.play();

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ­Ø¯ÙŠØ¯ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
  document.querySelectorAll('.video-item').forEach(v => v.classList.remove('active'));
  item.classList.add('active');

  currentVideoId = videoId;
  loadData();
});

// Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯
addCommentBtn.addEventListener('click', () => {
  const text = commentInput.value.trim();
  if (text === '') return alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚.');

  let commentsData = JSON.parse(localStorage.getItem('videoComments')) || {};
  if (!commentsData[currentVideoId]) commentsData[currentVideoId] = [];
  commentsData[currentVideoId].push(text);

  saveData(JSON.parse(localStorage.getItem('videoReactions')) || {}, commentsData);
  displayComments(commentsData[currentVideoId]);

  commentInput.value = '';
});

// Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙØ§Ø¹Ù„ (Ø¬Ø§Ù…ØŒ Ø¬Ø§Ø¯ÙˆØ±ØŒ Ø¶Ø­Ùƒ)
reactionButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const reaction = btn.getAttribute('data-reaction');

    let reactionsData = JSON.parse(localStorage.getItem('videoReactions')) || {};
    if (!reactionsData[currentVideoId]) {
      reactionsData[currentVideoId] = { like: 0, love: 0, laugh: 0 };
    }
    reactionsData[currentVideoId][reaction]++;

    saveData(reactionsData, JSON.parse(localStorage.getItem('videoComments')) || {});
    loadData();
  });
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ Ù…Ø±Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
loadData();
