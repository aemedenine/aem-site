// script.js

document.addEventListener('DOMContentLoaded', () => {
  let currentLang = document.documentElement.lang.startsWith('ar') ? 'ar' : 'fr';

  // تحديث الوقت والتاريخ
  function updateTime() {
    const now = new Date();
    const daysAr = ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت'];
    const monthsAr = ['جانفي','فيفري','مارس','أفريل','ماي','جوان','جويلية','أوت','سبتمبر','أكتوبر','نوفمبر','ديسمبر'];
    const daysFr = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
    const monthsFr = ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'];

    let day, month;
    if(currentLang === 'ar'){
      day = daysAr[now.getDay()];
      month = monthsAr[now.getMonth()];
    } else {
      day = daysFr[now.getDay()];
      month = monthsFr[now.getMonth()];
    }

    const date = now.getDate();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const seconds = now.getSeconds().toString().padStart(2, '0');

    const timeStr = `${hours}:${minutes}:${seconds}`;
    const dateStr = currentLang === 'ar' 
      ? `${day}، ${date} ${month}` 
      : `${day}, ${date} ${month}`;

    document.getElementById('current-time').textContent = `${dateStr} - ${timeStr}`;
  }

  // تحديث عداد الزيارات (محلي)
  function updateVisits() {
    const visitKey = 'aem-visit-count';
    let visits = parseInt(localStorage.getItem(visitKey)) || 0;
    visits++;
    localStorage.setItem(visitKey, visits);
    document.getElementById('visit-count').textContent = 
      currentLang === 'ar' 
      ? `عدد زياراتك: ${visits}` 
      : `Nombre de visites: ${visits}`;
  }

  // جلب أخبار BBC عربية (5 آخر الأخبار)
  async function fetchNews() {
    try {
      const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://feeds.bbci.co.uk/arabic/rss.xml');
      const data = await response.json();
      if(data.status === 'ok') {
        const newsItems = data.items.slice(0, 5).map(item => `• ${item.title}`).join(' ');
        document.getElementById('live-news').textContent = newsItems;
      } else {
        throw new Error('فشل تحميل الأخبار');
      }
    } catch (error) {
      document.getElementById('live-news').textContent = currentLang === 'ar' ? 'تعذر تحميل الأخبار حالياً.' : 'Impossible de charger les actualités.';
    }
  }

  // تبديل اللغة عربي/فرنسي
  function toggleLanguage() {
    if (currentLang === 'ar') {
      document.documentElement.lang = 'fr';
      document.documentElement.dir = 'ltr';
      currentLang = 'fr';

      document.querySelector('header h1').textContent = "Atelier Electronique Médenine";
      document.getElementById('qr-label').textContent = "📱 Scannez pour accès rapide";
      document.querySelector('.experience-badge').textContent = "🌼 Plus de 10 ans d'expérience";
      document.getElementById('whatsapp-btn').textContent = "📞 Contactez-nous WhatsApp";
      document.getElementById('maps-btn').textContent = "🗺️ Voir sur Google Maps";
      document.querySelector('.photos').textContent = "📷 Voir les photos";
      document.querySelector('.videos').textContent = "🎞️ Voir les vidéos";
      document.getElementById('radio-btn').textContent = radio.paused ? "📻 Écouter la radio" : "⏸️ Arrêter la radio";
      document.querySelector('.special-service-btn').textContent = "🛠️ Services de l'atelier";

      // تحديث الأسئلة الشائعة
      const faqs = [
        {
          q: "Comment puis-je envoyer un appareil pour réparation ?",
          a: "Vous pouvez envoyer l'appareil par courrier à l'atelier ou nous contacter pour organiser la collecte."
        },
        {
          q: "Quel est le délai moyen de réparation ?",
          a: "Le délai dépend du type de panne, mais généralement pas plus de 3 jours ouvrables."
        },
        {
          q: "Fournissez-vous des pièces d'origine ?",
          a: "Oui, nous fournissons des pièces d'origine et de haute qualité pour tous les appareils."
        },
        {
          q: "Comment suivre l'état de la réparation ?",
          a: "Nous envoyons des photos et vidéos de l'état de l'appareil pendant la réparation via WhatsApp."
        }
      ];
      const faqContainer = document.querySelector('.faq');
      faqContainer.innerHTML = '<h2>FAQ</h2>';
      faqs.forEach(item => {
        const faqItem = document.createElement('div');
        faqItem.classList.add('faq-item');
        faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
        faqContainer.appendChild(faqItem);
      });
      document.querySelectorAll('.faq-item h3').forEach(h3 => {
        h3.addEventListener('click', () => {
          h3.parentElement.classList.toggle('open');
        });
      });

      // تحديث الفوتر
      document.getElementById('footer-text').innerHTML = `
        📍 Médenine – Service dans toute la Tunisie | 📲 WhatsApp: 98192103<br>
        ⏰ Du lundi au samedi, 08:00 - 18:00 | Dimanche fermé
        <div class="social-icons">
          <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
            <img src="icons/facebook.svg" alt="Facebook" />
          </a>
          <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
            <img src="icons/instagram.svg" alt="Instagram" />
          </a>
          <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
            <img src="icons/whatsapp.svg" alt="WhatsApp" />
          </a>
        </div>
      `;

    } else {
      document.documentElement.lang = 'ar';
      document.documentElement.dir = 'rtl';
      currentLang = 'ar';

      document.querySelector('header h1').textContent = "Atelier Electronique Médenine";
      document.getElementById('qr-label').textContent = "📱 امسح للوصول السريع";
      document.querySelector('.experience-badge').textContent = "🌼 10+ سنوات خبرة";
      document.getElementById('whatsapp-btn').textContent = "📞 تواصل معنا واتساب";
      document.getElementById('maps-btn').textContent = "🗺️ شوفنا على Google Maps";
      document.querySelector('.photos').textContent = "📷 شوف الصور";
      document.querySelector('.videos').textContent = "🎞️ شوف الفيديو";
      document.getElementById('radio-btn').textContent = radio.paused ? "📻 شغّل الراديو" : "⏸️ أوقف الراديو";
      document.querySelector('.special-service-btn').textContent = "🛠️ خدمات الورشة";

      // تحديث الأسئلة الشائعة بالعربي
      const faqsAr = [
        {
          q: "كيف يمكنني إرسال جهاز للإصلاح؟",
          a: "يمكنك إرسال الجهاز عبر البريد إلى عنوان الورشة أو التواصل معنا لترتيب خدمة الاستلام."
        },
        {
          q: "ما هي مدة التصليح المعتادة؟",
          a: "مدة التصليح تختلف حسب نوع العطل، لكن غالباً لا تتجاوز 3 أيام عمل."
        },
        {
          q: "هل توفرون قطع غيار أصلية؟",
          a: "نعم، نوفر قطع غيار أصلية وذات جودة عالية لجميع الأجهزة."
        },
        {
          q: "كيف أتابع حالة الإصلاح؟",
          a: "نقوم بإرسال صور وفيديوهات لحالة الجهاز أثناء مراحل التصليح عبر واتساب."
        }
      ];
      const faqContainer = document.querySelector('.faq');
      faqContainer.innerHTML = '<h2>الأسئلة الشائعة</h2>';
      faqsAr.forEach(item => {
        const faqItem = document.createElement('div');
        faqItem.classList.add('faq-item');
        faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
        faqContainer.appendChild(faqItem);
      });
      document.querySelectorAll('.faq-item h3').forEach(h3 => {
        h3.addEventListener('click', () => {
          h3.parentElement.classList.toggle('open');
        });
      });

      // تحديث الفوتر بالعربي
      document.getElementById('footer-text').innerHTML = `
        📍 مدنين – نخدمو في كامل أنحاء تونس | 📲 WhatsApp:98192103<br>
        ⏰ من الإثنين للسبت، 08:00 - 18:00 | الأحد راحة
        <div class="social-icons">
          <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
            <img src="icons/facebook.svg" alt="Facebook" />
          </a>
          <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
            <img src="icons/instagram.svg" alt="Instagram" />
          </a>
          <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
            <img src="icons/whatsapp.svg" alt="WhatsApp" />
          </a>
        </div>
      `;
    }

    updateTime();
    fetchNews();
    updateVisits();
  }

  // إعداد زر تبديل اللغة
  document.getElementById('toggle-lang-btn').addEventListener('click', toggleLanguage);

  // تحديث الوقت كل ثانية
  updateTime();
  setInterval(updateTime, 1000);

  // تحميل الأخبار أول مرة
  fetchNews();

  // تحديث عداد الزيارات
  updateVisits();

  // راديو انترنت
  const radio = document.getElementById('radio-stream');
  const radioBtn = document.getElementById('radio-btn');
  radioBtn.addEventListener('click', () => {
    if (radio.paused) {
      radio.play().catch(() => {
        alert(currentLang === 'ar' ? 'اضغط على زر التشغيل مرة أخرى إذا لم يبدأ الصوت تلقائياً.' : 'Veuillez cliquer à nouveau pour démarrer le son.');
      });
      radioBtn.textContent = currentLang === 'ar' ? "⏸️ أوقف الراديو" : "⏸️ Arrêter la radio";
    } else {
      radio.pause();
      radioBtn.textContent = currentLang === 'ar' ? "📻 شغّل الراديو" : "📻 Écouter la radio";
    }
  });

  // تفعيل فتح/غلق الأسئلة الشائعة
  document.querySelectorAll('.faq-item h3').forEach(h3 => {
    h3.addEventListener('click', () => {
      h3.parentElement.classList.toggle('open');
    });
  });

});
