// script.js

document.addEventListener('DOMContentLoaded', () => {
  let currentLang = document.documentElement.lang.startsWith('ar') ? 'ar' : 'fr';

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
  function updateTime() {
    const now = new Date();
    const daysAr = ['Ø§Ù„Ø£Ø­Ø¯','Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†','Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡','Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡','Ø§Ù„Ø®Ù…ÙŠØ³','Ø§Ù„Ø¬Ù…Ø¹Ø©','Ø§Ù„Ø³Ø¨Øª'];
    const monthsAr = ['Ø¬Ø§Ù†ÙÙŠ','ÙÙŠÙØ±ÙŠ','Ù…Ø§Ø±Ø³','Ø£ÙØ±ÙŠÙ„','Ù…Ø§ÙŠ','Ø¬ÙˆØ§Ù†','Ø¬ÙˆÙŠÙ„ÙŠØ©','Ø£ÙˆØª','Ø³Ø¨ØªÙ…Ø¨Ø±','Ø£ÙƒØªÙˆØ¨Ø±','Ù†ÙˆÙÙ…Ø¨Ø±','Ø¯ÙŠØ³Ù…Ø¨Ø±'];
    const daysFr = ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'];
    const monthsFr = ['Janvier','FÃ©vrier','Mars','Avril','Mai','Juin','Juillet','AoÃ»t','Septembre','Octobre','Novembre','DÃ©cembre'];

    let day, month;
    if(currentLang === 'ar'){
      day = daysAr[now.getDay()];
      month = monthsAr[now.getMonth()];
    } else {
      day = daysFr[now.getDay()];
      month = monthsFr[now.getMonth()];
    }

    const date = now.getDate();
    const hours = now.getHours().toString().padStart(2, '0');
    const minutes = now.getMinutes().toString().padStart(2, '0');
    const seconds = now.getSeconds().toString().padStart(2, '0');

    const timeStr = `${hours}:${minutes}:${seconds}`;
    const dateStr = currentLang === 'ar' 
      ? `${day}ØŒ ${date} ${month}` 
      : `${day}, ${date} ${month}`;

    document.getElementById('current-time').textContent = `${dateStr} - ${timeStr}`;
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª (Ù…Ø­Ù„ÙŠ)
  function updateVisits() {
    const visitKey = 'aem-visit-count';
    let visits = parseInt(localStorage.getItem(visitKey)) || 0;
    visits++;
    localStorage.setItem(visitKey, visits);
    document.getElementById('visit-count').textContent = 
      currentLang === 'ar' 
      ? `Ø¹Ø¯Ø¯ Ø²ÙŠØ§Ø±Ø§ØªÙƒ: ${visits}` 
      : `Nombre de visites: ${visits}`;
  }

  // Ø¬Ù„Ø¨ Ø£Ø®Ø¨Ø§Ø± BBC Ø¹Ø±Ø¨ÙŠØ© (5 Ø¢Ø®Ø± Ø§Ù„Ø£Ø®Ø¨Ø§Ø±)
  async function fetchNews() {
    try {
      const response = await fetch('https://api.rss2json.com/v1/api.json?rss_url=https://feeds.bbci.co.uk/arabic/rss.xml');
      const data = await response.json();
      if(data.status === 'ok') {
        const newsItems = data.items.slice(0, 5).map(item => `â€¢ ${item.title}`).join(' ');
        document.getElementById('live-news').textContent = newsItems;
      } else {
        throw new Error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±');
      }
    } catch (error) {
      document.getElementById('live-news').textContent = currentLang === 'ar' ? 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹.' : 'Impossible de charger les actualitÃ©s.';
    }
  }

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø¹Ø±Ø¨ÙŠ/ÙØ±Ù†Ø³ÙŠ
  function toggleLanguage() {
    if (currentLang === 'ar') {
      document.documentElement.lang = 'fr';
      document.documentElement.dir = 'ltr';
      currentLang = 'fr';

      document.querySelector('header h1').textContent = "Atelier Electronique MÃ©denine";
      document.getElementById('qr-label').textContent = "ğŸ“± Scannez pour accÃ¨s rapide";
      document.querySelector('.experience-badge').textContent = "ğŸŒ¼ Plus de 10 ans d'expÃ©rience";
      document.getElementById('whatsapp-btn').textContent = "ğŸ“ Contactez-nous WhatsApp";
      document.getElementById('maps-btn').textContent = "ğŸ—ºï¸ Voir sur Google Maps";
      document.querySelector('.photos').textContent = "ğŸ“· Voir les photos";
      document.querySelector('.videos').textContent = "ğŸï¸ Voir les vidÃ©os";
      document.getElementById('radio-btn').textContent = radio.paused ? "ğŸ“» Ã‰couter la radio" : "â¸ï¸ ArrÃªter la radio";
      document.querySelector('.special-service-btn').textContent = "ğŸ› ï¸ Services de l'atelier";

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
      const faqs = [
        {
          q: "Comment puis-je envoyer un appareil pour rÃ©paration ?",
          a: "Vous pouvez envoyer l'appareil par courrier Ã  l'atelier ou nous contacter pour organiser la collecte."
        },
        {
          q: "Quel est le dÃ©lai moyen de rÃ©paration ?",
          a: "Le dÃ©lai dÃ©pend du type de panne, mais gÃ©nÃ©ralement pas plus de 3 jours ouvrables."
        },
        {
          q: "Fournissez-vous des piÃ¨ces d'origine ?",
          a: "Oui, nous fournissons des piÃ¨ces d'origine et de haute qualitÃ© pour tous les appareils."
        },
        {
          q: "Comment suivre l'Ã©tat de la rÃ©paration ?",
          a: "Nous envoyons des photos et vidÃ©os de l'Ã©tat de l'appareil pendant la rÃ©paration via WhatsApp."
        }
      ];
      const faqContainer = document.querySelector('.faq');
      faqContainer.innerHTML = '<h2>FAQ</h2>';
      faqs.forEach(item => {
        const faqItem = document.createElement('div');
        faqItem.classList.add('faq-item');
        faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
        faqContainer.appendChild(faqItem);
      });
      document.querySelectorAll('.faq-item h3').forEach(h3 => {
        h3.addEventListener('click', () => {
          h3.parentElement.classList.toggle('open');
        });
      });

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØªØ±
      document.getElementById('footer-text').innerHTML = `
        ğŸ“ MÃ©denine â€“ Service dans toute la Tunisie | ğŸ“² WhatsApp: 98192103<br>
        â° Du lundi au samedi, 08:00 - 18:00 | Dimanche fermÃ©
        <div class="social-icons">
          <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
            <img src="icons/facebook.svg" alt="Facebook" />
          </a>
          <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
            <img src="icons/instagram.svg" alt="Instagram" />
          </a>
          <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
            <img src="icons/whatsapp.svg" alt="WhatsApp" />
          </a>
        </div>
      `;

    } else {
      document.documentElement.lang = 'ar';
      document.documentElement.dir = 'rtl';
      currentLang = 'ar';

      document.querySelector('header h1').textContent = "Atelier Electronique MÃ©denine";
      document.getElementById('qr-label').textContent = "ğŸ“± Ø§Ù…Ø³Ø­ Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹";
      document.querySelector('.experience-badge').textContent = "ğŸŒ¼ 10+ Ø³Ù†ÙˆØ§Øª Ø®Ø¨Ø±Ø©";
      document.getElementById('whatsapp-btn').textContent = "ğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙˆØ§ØªØ³Ø§Ø¨";
      document.getElementById('maps-btn').textContent = "ğŸ—ºï¸ Ø´ÙˆÙÙ†Ø§ Ø¹Ù„Ù‰ Google Maps";
      document.querySelector('.photos').textContent = "ğŸ“· Ø´ÙˆÙ Ø§Ù„ØµÙˆØ±";
      document.querySelector('.videos').textContent = "ğŸï¸ Ø´ÙˆÙ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ";
      document.getElementById('radio-btn').textContent = radio.paused ? "ğŸ“» Ø´ØºÙ‘Ù„ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ" : "â¸ï¸ Ø£ÙˆÙ‚Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ";
      document.querySelector('.special-service-btn').textContent = "ğŸ› ï¸ Ø®Ø¯Ù…Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©";

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
      const faqsAr = [
        {
          q: "ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù‡Ø§Ø² Ù„Ù„Ø¥ØµÙ„Ø§Ø­ØŸ",
          a: "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¥Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ±Ø´Ø© Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„ØªØ±ØªÙŠØ¨ Ø®Ø¯Ù…Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…."
        },
        {
          q: "Ù…Ø§ Ù‡ÙŠ Ù…Ø¯Ø© Ø§Ù„ØªØµÙ„ÙŠØ­ Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø©ØŸ",
          a: "Ù…Ø¯Ø© Ø§Ù„ØªØµÙ„ÙŠØ­ ØªØ®ØªÙ„Ù Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ØŒ Ù„ÙƒÙ† ØºØ§Ù„Ø¨Ø§Ù‹ Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² 3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„."
        },
        {
          q: "Ù‡Ù„ ØªÙˆÙØ±ÙˆÙ† Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£ØµÙ„ÙŠØ©ØŸ",
          a: "Ù†Ø¹Ù…ØŒ Ù†ÙˆÙØ± Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£ØµÙ„ÙŠØ© ÙˆØ°Ø§Øª Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©."
        },
        {
          q: "ÙƒÙŠÙ Ø£ØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ØŸ",
          a: "Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ± ÙˆÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£Ø«Ù†Ø§Ø¡ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªØµÙ„ÙŠØ­ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨."
        }
      ];
      const faqContainer = document.querySelector('.faq');
      faqContainer.innerHTML = '<h2>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h2>';
      faqsAr.forEach(item => {
        const faqItem = document.createElement('div');
        faqItem.classList.add('faq-item');
        faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
        faqContainer.appendChild(faqItem);
      });
      document.querySelectorAll('.faq-item h3').forEach(h3 => {
        h3.addEventListener('click', () => {
          h3.parentElement.classList.toggle('open');
        });
      });

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙÙˆØªØ± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠ
      document.getElementById('footer-text').innerHTML = `
        ğŸ“ Ù…Ø¯Ù†ÙŠÙ† â€“ Ù†Ø®Ø¯Ù…Ùˆ ÙÙŠ ÙƒØ§Ù…Ù„ Ø£Ù†Ø­Ø§Ø¡ ØªÙˆÙ†Ø³ | ğŸ“² WhatsApp:98192103<br>
        â° Ù…Ù† Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† Ù„Ù„Ø³Ø¨ØªØŒ 08:00 - 18:00 | Ø§Ù„Ø£Ø­Ø¯ Ø±Ø§Ø­Ø©
        <div class="social-icons">
          <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
            <img src="icons/facebook.svg" alt="Facebook" />
          </a>
          <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
            <img src="icons/instagram.svg" alt="Instagram" />
          </a>
          <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
            <img src="icons/whatsapp.svg" alt="WhatsApp" />
          </a>
        </div>
      `;
    }

    updateTime();
    fetchNews();
    updateVisits();
  }

  // Ø¥Ø¹Ø¯Ø§Ø¯ Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ©
  document.getElementById('toggle-lang-btn').addEventListener('click', toggleLanguage);

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
  updateTime();
  setInterval(updateTime, 1000);

  // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø£ÙˆÙ„ Ù…Ø±Ø©
  fetchNews();

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
  updateVisits();

  // Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù†ØªØ±Ù†Øª
  const radio = document.getElementById('radio-stream');
  const radioBtn = document.getElementById('radio-btn');
  radioBtn.addEventListener('click', () => {
    if (radio.paused) {
      radio.play().catch(() => {
        alert(currentLang === 'ar' ? 'Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¨Ø¯Ø£ Ø§Ù„ØµÙˆØª ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹.' : 'Veuillez cliquer Ã  nouveau pour dÃ©marrer le son.');
      });
      radioBtn.textContent = currentLang === 'ar' ? "â¸ï¸ Ø£ÙˆÙ‚Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ" : "â¸ï¸ ArrÃªter la radio";
    } else {
      radio.pause();
      radioBtn.textContent = currentLang === 'ar' ? "ğŸ“» Ø´ØºÙ‘Ù„ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ" : "ğŸ“» Ã‰couter la radio";
    }
  });

  // ØªÙØ¹ÙŠÙ„ ÙØªØ­/ØºÙ„Ù‚ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
  document.querySelectorAll('.faq-item h3').forEach(h3 => {
    h3.addEventListener('click', () => {
      h3.parentElement.classList.toggle('open');
    });
  });

});
