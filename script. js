document.addEventListener('DOMContentLoaded', () => {
  let currentLang = 'ar';

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
  function updateTime() {
    const now = new Date();
    const timeElem = document.getElementById('current-time');
    if (!timeElem) return;
    // ØµÙŠØºØ© Ø§Ù„ÙˆÙ‚Øª Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©
    const options = {
      hour: '2-digit',
      minute: '2-digit',
      second: '2-digit',
    };
    timeElem.textContent = now.toLocaleTimeString(currentLang === 'ar' ? 'ar-TN' : 'fr-FR', options);
  }

  // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª (Ù…Ø«Ø§Ù„ ÙˆÙ‡Ù…ÙŠ)
  function updateVisits() {
    const visitsElem = document.getElementById('visit-count');
    if (!visitsElem) return;
    // Ù‡Ù†Ø§ Ù…Ù…ÙƒÙ† ØªØ±Ø¨Ø· Ù…Ø¹ Ø¹Ø¯Ø§Ø¯ Ø­Ù‚ÙŠÙ‚ÙŠ Ø£Ùˆ ØªØ­Ø· Ø¹Ø¯Ø¯ ÙˆÙ‡Ù…ÙŠ
    let visits = localStorage.getItem('visit-count') || 0;
    visits = parseInt(visits) + 1;
    localStorage.setItem('visit-count', visits);
    visitsElem.textContent = visits;
  }

  // Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø§Ù„Ø­ÙŠØ© (Ù…Ø«Ø§Ù„ ÙˆÙ‡Ù…ÙŠ)
  async function fetchNews() {
    try {
      const news = [
        "ğŸ“¢ ÙˆØ±Ø´Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙƒ Ø§Ù„Ø±Ø­Ù…Ø§Ù†ÙŠ ØªÙØªØ­ Ø£Ø¨ÙˆØ§Ø¨Ù‡Ø§ Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª.",
        "ğŸ”§ Ø®Ø¯Ù…Ø§Øª ØªØµÙ„ÙŠØ­ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ© Ø¨Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© ÙˆØ¨Ø£Ø³Ø¹Ø§Ø± Ù…Ù†Ø§ÙØ³Ø©.",
        "ğŸŒ Ø§Ù„ØªÙˆØµÙŠÙ„ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ù…ØªÙˆÙØ± Ù„ÙƒÙ„ Ø£Ù†Ø­Ø§Ø¡ ØªÙˆÙ†Ø³.",
        "ğŸ“± ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±."
      ];
      const liveNewsElem = document.getElementById('live-news');
      if (liveNewsElem) {
        liveNewsElem.textContent = news.join('  â€¢  ');
      }
    } catch (e) {
      const liveNewsElem = document.getElementById('live-news');
      if (liveNewsElem) liveNewsElem.textContent = 'ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø­Ø§Ù„ÙŠØ§Ù‹.';
    }
  }

  // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ù„ØºØ© Ø¹Ø±Ø¨ÙŠ/ÙØ±Ù†Ø³ÙŠ
  const experienceBadge = document.querySelector('.experience-badge');
  const radio = document.getElementById('radio-stream');
  const radioBtn = document.getElementById('radio-btn');

  window.toggleLanguage = function() {
    if (currentLang === 'ar') {
      document.documentElement.lang = 'fr';
      currentLang = 'fr';

      document.querySelector('header h1').textContent = "Atelier Electronique MÃ©denine";
      const qrLabel = document.getElementById('qr-label');
      if (qrLabel) qrLabel.textContent = "ğŸ“± Scannez pour accÃ¨s rapide";
      if (experienceBadge) experienceBadge.textContent = "ğŸŒ¼ Plus de 10 ans d'expÃ©rience";
      const slogan = document.getElementById('slogan');
      if (slogan) slogan.textContent = "Atelier Electronique MÃ©denine - Service dans toute la Tunisie";
      const whatsappBtn = document.getElementById('whatsapp-btn');
      if (whatsappBtn) whatsappBtn.textContent = "ğŸ“ Contactez-nous WhatsApp";
      const mapsBtn = document.getElementById('maps-btn');
      if (mapsBtn) mapsBtn.textContent = "ğŸ—ºï¸ Voir sur Google Maps";
      const photosBtn = document.querySelector('.photos');
      if (photosBtn) photosBtn.textContent = "ğŸ“· Voir les photos";
      const videosBtn = document.querySelector('.videos');
      if (videosBtn) videosBtn.textContent = "ğŸï¸ Voir les vidÃ©os";
      if (radioBtn && radio) radioBtn.textContent = radio.paused ? "ğŸ“» Ã‰couter la radio" : "â¸ï¸ ArrÃªter la radio";
      const specialBtn = document.querySelector('.special-service-btn');
      if (specialBtn) specialBtn.textContent = "ğŸ› ï¸ Services de l'atelier";

      // Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© Ø¨Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©
      const faqs = [
        { q: "Comment puis-je envoyer un appareil pour rÃ©paration ?", a: "Vous pouvez envoyer l'appareil par courrier Ã  l'atelier ou nous contacter pour organiser la collecte." },
        { q: "Quel est le dÃ©lai moyen de rÃ©paration ?", a: "Le dÃ©lai dÃ©pend du type de panne, mais gÃ©nÃ©ralement pas plus de 3 jours ouvrables." },
        { q: "Fournissez-vous des piÃ¨ces d'origine ?", a: "Oui, nous fournissons des piÃ¨ces d'origine et de haute qualitÃ© pour tous les appareils." },
        { q: "Comment suivre l'Ã©tat de la rÃ©paration ?", a: "Nous envoyons des photos et vidÃ©os de l'Ã©tat de l'appareil pendant la rÃ©paration via WhatsApp." }
      ];
      const faqContainer = document.querySelector('.faq');
      if (faqContainer) {
        faqContainer.innerHTML = '<h2>FAQ</h2>';
        faqs.forEach(item => {
          const faqItem = document.createElement('div');
          faqItem.classList.add('faq-item');
          faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
          faqContainer.appendChild(faqItem);
        });
        // ÙØ¹Ø§Ù„ÙŠØ§Øª Ø§Ù„ÙØªØ­/Ø§Ù„ØºÙ„Ù‚ Ù„Ù„Ø£Ø³Ø¦Ù„Ø©
        faqContainer.querySelectorAll('.faq-item h3').forEach(h3 => {
          h3.addEventListener('click', () => {
            h3.parentElement.classList.toggle('open');
          });
        });
      }

      // ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙÙˆØªØ±
      const footerText = document.getElementById('footer-text');
      if (footerText) {
        footerText.innerHTML = `
          ğŸ“ MÃ©denine â€“ Service dans toute la Tunisie | ğŸ“² WhatsApp: 98192103<br>
          â° Du lundi au samedi, 08:00 - 18:00 | Dimanche fermÃ©
          <div class="social-icons">
            <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
              <img src="icons/facebook.svg" alt="Facebook" />
            </a>
            <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
              <img src="icons/instagram.svg" alt="Instagram" />
            </a>
            <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
              <img src="icons/whatsapp.svg" alt="WhatsApp" />
            </a>
          </div>
        `;
      }
    } else {
      // Ø¹Ø±Ø¨ÙŠ
      document.documentElement.lang = 'ar';
      currentLang = 'ar';

      document.querySelector('header h1').textContent = "Atelier Electronique MÃ©denine";
      const qrLabel = document.getElementById('qr-label');
      if (qrLabel) qrLabel.textContent = "ğŸ“± Ø§Ù…Ø³Ø­ Ù„Ù„ÙˆØµÙˆÙ„ Ø§Ù„Ø³Ø±ÙŠØ¹";
      if (experienceBadge) experienceBadge.textContent = "ğŸŒ¼ 10+ Ø³Ù†ÙˆØ§Øª Ø®Ø¨Ø±Ø©";
      const slogan = document.getElementById('slogan');
      if (slogan) slogan.textContent = "ÙˆØ±Ø´Ø© Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠÙƒ Ø§Ù„Ø±Ø­Ù…Ø§Ù†ÙŠ - Ù†Ø®Ø¯Ù…Ùˆ ØªÙˆÙ†Ø³ Ø§Ù„ÙƒÙ„";
      const whatsappBtn = document.getElementById('whatsapp-btn');
      if (whatsappBtn) whatsappBtn.textContent = "ğŸ“ ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙˆØ§ØªØ³Ø§Ø¨";
      const mapsBtn = document.getElementById('maps-btn');
      if (mapsBtn) mapsBtn.textContent = "ğŸ—ºï¸ Ø´ÙˆÙÙ†Ø§ Ø¹Ù„Ù‰ Google Maps";
      const photosBtn = document.querySelector('.photos');
      if (photosBtn) photosBtn.textContent = "ğŸ“· Ø´ÙˆÙ Ø§Ù„ØµÙˆØ±";
      const videosBtn = document.querySelector('.videos');
      if (videosBtn) videosBtn.textContent = "ğŸï¸ Ø´ÙˆÙ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ";
      if (radioBtn && radio) radioBtn.textContent = radio.paused ? "ğŸ“» Ø´ØºÙ‘Ù„ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ" : "â¸ï¸ Ø£ÙˆÙ‚Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ";
      const specialBtn = document.querySelector('.special-service-btn');
      if (specialBtn) specialBtn.textContent = "ğŸ› ï¸ Ø®Ø¯Ù…Ø§Øª Ø§Ù„ÙˆØ±Ø´Ø©";

      const faqsAr = [
        { q: "ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø¬Ù‡Ø§Ø² Ù„Ù„Ø¥ØµÙ„Ø§Ø­ØŸ", a: "ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¬Ù‡Ø§Ø² Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¥Ù„Ù‰ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙˆØ±Ø´Ø© Ø£Ùˆ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ù„ØªØ±ØªÙŠØ¨ Ø®Ø¯Ù…Ø© Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…." },
        { q: "Ù…Ø§ Ù‡ÙŠ Ù…Ø¯Ø© Ø§Ù„ØªØµÙ„ÙŠØ­ Ø§Ù„Ù…Ø¹ØªØ§Ø¯Ø©ØŸ", a: "Ù…Ø¯Ø© Ø§Ù„ØªØµÙ„ÙŠØ­ ØªØ®ØªÙ„Ù Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø·Ù„ØŒ Ù„ÙƒÙ† ØºØ§Ù„Ø¨Ø§Ù‹ Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² 3 Ø£ÙŠØ§Ù… Ø¹Ù…Ù„." },
        { q: "Ù‡Ù„ ØªÙˆÙØ±ÙˆÙ† Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£ØµÙ„ÙŠØ©ØŸ", a: "Ù†Ø¹Ù…ØŒ Ù†ÙˆÙØ± Ù‚Ø·Ø¹ ØºÙŠØ§Ø± Ø£ØµÙ„ÙŠØ© ÙˆØ°Ø§Øª Ø¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©." },
        { q: "ÙƒÙŠÙ Ø£ØªØ§Ø¨Ø¹ Ø­Ø§Ù„Ø© Ø§Ù„Ø¥ØµÙ„Ø§Ø­ØŸ", a: "Ù†Ù‚ÙˆÙ… Ø¨Ø¥Ø±Ø³Ø§Ù„ ØµÙˆØ± ÙˆÙÙŠØ¯ÙŠÙˆÙ‡Ø§Øª Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø£Ø«Ù†Ø§Ø¡ Ù…Ø±Ø§Ø­Ù„ Ø§Ù„ØªØµÙ„ÙŠØ­ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨." }
      ];
      const faqContainer = document.querySelector('.faq');
      if (faqContainer) {
        faqContainer.innerHTML = '<h2>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h2>';
        faqsAr.forEach(item => {
          const faqItem = document.createElement('div');
          faqItem.classList.add('faq-item');
          faqItem.innerHTML = `<h3>${item.q}</h3><div class="answer">${item.a}</div>`;
          faqContainer.appendChild(faqItem);
        });
        faqContainer.querySelectorAll('.faq-item h3').forEach(h3 => {
          h3.addEventListener('click', () => {
            h3.parentElement.classList.toggle('open');
          });
        });
      }

      // ØªØ±Ø¬Ù…Ø© Ø§Ù„ÙÙˆØªØ±
      const footerText = document.getElementById('footer-text');
      if (footerText) {
        footerText.innerHTML = `
          ğŸ“ Ù…Ø¯Ù†ÙŠÙ† â€“ Ù†Ø®Ø¯Ù…Ùˆ ÙÙŠ ÙƒØ§Ù…Ù„ Ø£Ù†Ø­Ø§Ø¡ ØªÙˆÙ†Ø³ | ğŸ“² WhatsApp:98192103<br>
          â° Ù…Ù† Ø§Ù„Ø¥Ø«Ù†ÙŠÙ† Ù„Ù„Ø³Ø¨ØªØŒ 08:00 - 18:00 | Ø§Ù„Ø£Ø­Ø¯ Ø±Ø§Ø­Ø©
          <div class="social-icons">
            <a href="https://www.facebook.com/AEMednine" target="_blank" rel="noopener noreferrer" title="Facebook">
              <img src="icons/facebook.svg" alt="Facebook" />
            </a>
            <a href="https://www.instagram.com/aemedenine/" target="_blank" rel="noopener noreferrer" title="Instagram">
              <img src="icons/instagram.svg" alt="Instagram" />
            </a>
            <a href="https://wa.me/21698192103" target="_blank" rel="noopener noreferrer" title="WhatsApp">
              <img src="icons/whatsapp.svg" alt="WhatsApp" />
            </a>
          </div>
        `;
      }
    }
  };

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª
  updateTime();
  updateVisits();
  fetchNews();

  setInterval(updateTime, 1000 * 60); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

  // Ø§Ù„Ù„Ø§ÙŠØªØ¨ÙˆÙƒØ³ Ù„Ù„ØµÙˆØ±
  window.openLightbox = function(src) {
    const lightbox = document.getElementById('lightbox');
    const lightboxImg = document.getElementById('lightbox-img');
    if (lightbox && lightboxImg) {
      lightboxImg.src = src;
      lightbox.style.display = 'flex';
    }
  };
  window.closeLightbox = function() {
    const lightbox = document.getElementById('lightbox');
    if (lightbox) lightbox.style.display = 'none';
  };

  // ØªÙØ§Ø¹Ù„ (Ù„Ø§ÙŠÙƒØŒ Ø­Ø¨ØŒ ØªØµÙÙŠÙ‚)
  window.addReaction = function(mediaId, reaction) {
    alert(`Ø´ÙƒØ±Ø§Ù‹ Ø¹Ù„Ù‰ ØªÙØ§Ø¹Ù„Ùƒ ${reaction} Ù„Ù„ØµÙˆØ±Ø©/Ø§Ù„ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… ${mediaId}`);
  };

  // Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚
  window.addComment = function(mediaId) {
    const textarea = document.getElementById(`comment-input-${mediaId}`);
    if (!textarea) return;
    const commentText = textarea.value.trim();
    if (!commentText) {
      alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© ØªØ¹Ù„ÙŠÙ‚ Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
      return;
    }
    const commentsList = document.getElementById(`comments-${mediaId}`);
    if (!commentsList) return;
    const newComment = document.createElement('div');
    newComment.classList.add('comment');
    newComment.textContent = commentText;
    commentsList.appendChild(newComment);
    textarea.value = '';
  };

  // Ø±Ø§Ø¯ÙŠÙˆ
  const radioStream = document.getElementById('radio-stream');
  if (radioStream) {
    const radioButton = document.getElementById('radio-btn');
    if (radioButton) {
      radioButton.addEventListener('click', () => {
        if (radioStream.paused) {
          radioStream.play();
          radioButton.textContent = currentLang === 'ar' ? "â¸ï¸ Ø£ÙˆÙ‚Ù Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ" : "â¸ï¸ ArrÃªter la radio";
        } else {
          radioStream.pause();
          radioButton.textContent = currentLang === 'ar' ? "ğŸ“» Ø´ØºÙ‘Ù„ Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ" : "ğŸ“» Ã‰couter la radio";
        }
      });
    }
  }
});
