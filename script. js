// ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„ØªØ§Ø±ÙŠØ®
function updateTime() {
  const now = new Date();
  const daysAr = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];
  const daysFr = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
  const monthsAr = ['Ø¬Ø§Ù†ÙÙŠ', 'ÙÙŠÙØ±ÙŠ', 'Ù…Ø§Ø±Ø³', 'Ø£ÙØ±ÙŠÙ„', 'Ù…Ø§ÙŠ', 'Ø¬ÙˆØ§Ù†', 'Ø¬ÙˆÙŠÙ„ÙŠØ©', 'Ø£ÙˆØª', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  const monthsFr = ['Janvier', 'FÃ©vrier', 'Mars', 'Avril', 'Mai', 'Juin', 'Juillet', 'AoÃ»t', 'Septembre', 'Octobre', 'Novembre', 'DÃ©cembre'];

  let lang = localStorage.getItem('lang') || 'ar';

  const dayName = lang === 'ar' ? daysAr[now.getDay()] : daysFr[now.getDay()];
  const monthName = lang === 'ar' ? monthsAr[now.getMonth()] : monthsFr[now.getMonth()];

  const date = now.getDate();
  const hours = now.getHours().toString().padStart(2, '0');
  const minutes = now.getMinutes().toString().padStart(2, '0');

  const timeString = lang === 'ar'
    ? `${dayName} ${date} ${monthName} - ${hours}:${minutes}`
    : `${dayName} ${date} ${monthName} - ${hours}h${minutes}`;

  const timeElem = document.getElementById('current-time');
  if (timeElem) {
    timeElem.textContent = timeString;
  }
}

// Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ù…Ø¹ ØªØ®Ø²ÙŠÙ† Ù…Ø­Ù„ÙŠ
function updateVisits() {
  let visits = localStorage.getItem('visit-count');
  visits = visits ? parseInt(visits) + 1 : 1;
  localStorage.setItem('visit-count', visits);
  const visitElem = document.getElementById('visit-count');
  if (visitElem) {
    visitElem.textContent = (localStorage.getItem('lang') === 'fr') 
      ? `Nombre de visites: ${visits}` 
      : `Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${visits}`;
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø£Ø®Ø¨Ø§Ø± BBC Ø¹Ø±Ø¨ÙŠ (Ø£Ùˆ ÙØ±Ù†Ø³ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ù„ØºØ©)
function loadNews() {
  const rssUrl = 'http://feeds.bbci.co.uk/arabic/rss.xml';
  const newsElem = document.getElementById('live-news');
  fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(rssUrl)}`)
    .then(response => response.json())
    .then(data => {
      if (!data.items) throw new Error('No news items');
      let newsItems = data.items.slice(0, 4);
      let lang = localStorage.getItem('lang') || 'ar';

      if (lang === 'fr') {
        // Ø¨Ø¯Ù„ Ø±Ø§Ø¨Ø· RSS Ù„ÙØ±Ù†Ø³ÙŠØ© BBC Ù„Ùˆ ØªØ­Ø¨ (Ù…Ø«Ù„Ø§Ù‹)
        // Ù„ÙƒÙ† Ù‡Ù†Ø§ Ù†Ø®Ù„ÙŠ Ù†ÙØ³ Ø§Ù„Ø£Ø®Ø¨Ø§Ø± Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¹Ø´Ø§Ù† Ø§Ù„Ø¨Ø³Ø§Ø·Ø©
        newsItems = data.items.slice(0, 4);
      }

      const newsText = newsItems.map(item => `ðŸ“° ${item.title}`).join(' âš¡ ');
      if (newsElem) newsElem.textContent = newsText;
    })
    .catch(err => {
      if (newsElem) newsElem.textContent = (localStorage.getItem('lang') === 'fr')
        ? 'âŒ Ã‰chec du chargement des actualitÃ©s.'
        : 'âŒ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø®Ø¨Ø§Ø±.';
    });
}

// ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© ÙˆØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù†ØµÙˆØµ
function toggleLang() {
  let currentLang = localStorage.getItem('lang') || 'ar';
  let newLang = currentLang === 'ar' ? 'fr' : 'ar';
  localStorage.setItem('lang', newLang);
  applyLang();
}

function applyLang() {
  let lang = localStorage.getItem('lang') || 'ar';
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

  // Ø²Ø± ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
  const langToggleBtn = document.querySelector('.lang-toggle');
  if (langToggleBtn) {
    langToggleBtn.textContent = lang === 'ar' ? 'FranÃ§ais' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
  }

  // ØªØºÙŠÙŠØ± Ù†Øµ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¹Ø§Ù… Ù…Ø«Ù„Ø§Ù‹
  const titleElem = document.getElementById('title');
  if (titleElem) {
    titleElem.textContent = (lang === 'ar') ? titleElem.dataset.ar : titleElem.dataset.fr;
  }

  // ÙƒÙ„ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†ØµÙˆØµ Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„Ù„ØºØ§Øª
  document.querySelectorAll('.t').forEach(el => {
    if (el.dataset && el.dataset.ar && el.dataset.fr) {
      el.textContent = lang === 'ar' ? el.dataset.ar : el.dataset.fr;
    }
  });

  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆÙ‚Øª ÙˆØ§Ù„Ø²ÙŠØ§Ø±Ø§Øª ÙˆØ§Ù„Ø£Ø®Ø¨Ø§Ø± Ø¨Ø¹Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©
  updateTime();
  updateVisits();
  loadNews();
}

// Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± (Lightbox)
function openLightbox(src) {
  const lightbox = document.getElementById('lightbox');
  const img = document.getElementById('lightbox-img');
  if (lightbox && img) {
    img.src = src;
    lightbox.style.display = 'flex';
  }
}

function closeLightbox() {
  const lightbox = document.getElementById('lightbox');
  if (lightbox) {
    lightbox.style.display = 'none';
  }
}

// ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© (ÙØªØ­ ÙˆØºÙ„Ù‚)
function setupFAQ() {
  document.querySelectorAll('.faq-item h3').forEach(header => {
    header.addEventListener('click', () => {
      header.parentElement.classList.toggle('open');
    });
  });
}

// Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù‚Ø±Ø¢Ù† (ØªØ´ØºÙŠÙ„/Ø¥ÙŠÙ‚Ø§Ù)
let radioPlaying = false;
let radioAudio = null;

function toggleRadio() {
  if (!radioAudio) {
    radioAudio = new Audio('https://server7.mp3quran.net/maqri/002.mp3');
    radioAudio.loop = true;
  }
  if (radioPlaying) {
    radioAudio.pause();
    radioPlaying = false;
    document.getElementById('radio-btn').textContent = (localStorage.getItem('lang') === 'fr') ? 'â–¶ï¸ Radio' : 'â–¶ï¸ Ø±Ø§Ø¯ÙŠÙˆ Ø§Ù„Ù‚Ø±Ø¢Ù†';
  } else {
    radioAudio.play();
    radioPlaying = true;
    document.getElementById('radio-btn').textContent = (localStorage.getItem('lang') === 'fr') ? 'â¸ï¸ Pause' : 'â¸ï¸ Ø¥ÙŠÙ‚Ø§Ù';
  }
}

// ØªÙ‡ÙŠØ¦Ø© ÙƒÙ„ Ø§Ù„ÙˆØ¸Ø§Ø¦Ù Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', () => {
  applyLang();
  setupFAQ();
  updateTime();
  updateVisits();
  loadNews();
  setInterval(updateTime, 60000);

  // Ø±Ø¨Ø· Ø²Ø± Ø§Ù„Ø±Ø§Ø¯ÙŠÙˆ Ù„Ùˆ Ù…ÙˆØ¬ÙˆØ¯
  const radioBtn = document.getElementById('radio-btn');
  if (radioBtn) {
    radioBtn.addEventListener('click', toggleRadio);
  }

  // Ø±Ø¨Ø· Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù€ lightbox Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡
  const lightbox = document.getElementById('lightbox');
  if (lightbox) {
    lightbox.addEventListener('click', closeLightbox);
  }
});
