const videoList = document.getElementById('video-list');
const mainVideo = document.getElementById('main-video');
const commentsList = document.getElementById('comments-list');
const commentInput = document.getElementById('comment-input');
const addCommentBtn = document.getElementById('add-comment-btn');
const reactionButtons = document.querySelectorAll('.reactions button');

let currentVideoId = 'video1';

// تحميل التفاعلات والتعليقات من localStorage
function loadData() {
  const reactionsData = JSON.parse(localStorage.getItem('videoReactions')) || {};
  const commentsData = JSON.parse(localStorage.getItem('videoComments')) || {};

  // عرض التعليقات للفيديو الحالي
  displayComments(commentsData[currentVideoId] || []);

  // تهيئة أزرار التفاعل مع عدد الأصوات
  reactionButtons.forEach(btn => {
    const reaction = btn.getAttribute('data-reaction');
    const count = reactionsData[currentVideoId]?.[reaction] || 0;
    if (reaction === 'like') btn.textContent = `❤️ ${count}`;
    else if (reaction === 'love') btn.textContent = `😍 ${count}`;
    else if (reaction === 'laugh') btn.textContent = `😂 ${count}`;
  });
}

// حفظ التفاعلات والتعليقات في localStorage
function saveData(reactionsData, commentsData) {
  localStorage.setItem('videoReactions', JSON.stringify(reactionsData));
  localStorage.setItem('videoComments', JSON.stringify(commentsData));
}

// عرض التعليقات في القائمة
function displayComments(comments) {
  commentsList.innerHTML = '';
  if (comments.length === 0) {
    commentsList.innerHTML = '<p>لا توجد تعليقات حتى الآن.</p>';
    return;
  }
  comments.forEach(comment => {
    const div = document.createElement('div');
    div.className = 'comment';
    div.textContent = comment;
    commentsList.appendChild(div);
  });
}

// تغيير الفيديو عند النقر على عنصر في القائمة
videoList.addEventListener('click', e => {
  let item = e.target;
  while (item && !item.classList.contains('video-item')) {
    item = item.parentElement;
  }
  if (!item) return;
  if (item.classList.contains('active')) return; // نفس الفيديو

  const src = item.getAttribute('data-src');
  const poster = item.getAttribute('data-poster');
  const videoId = item.getAttribute('data-id');

  mainVideo.src = src;
  mainVideo.poster = poster;
  mainVideo.play();

  // تحديث التحديد في القائمة
  document.querySelectorAll('.video-item').forEach(v => v.classList.remove('active'));
  item.classList.add('active');

  currentVideoId = videoId;
  loadData();
});

// إضافة تعليق جديد
addCommentBtn.addEventListener('click', () => {
  const text = commentInput.value.trim();
  if (text === '') return alert('الرجاء كتابة تعليق.');

  let commentsData = JSON.parse(localStorage.getItem('videoComments')) || {};
  if (!commentsData[currentVideoId]) commentsData[currentVideoId] = [];
  commentsData[currentVideoId].push(text);

  saveData(JSON.parse(localStorage.getItem('videoReactions')) || {}, commentsData);
  displayComments(commentsData[currentVideoId]);

  commentInput.value = '';
});

// التعامل مع أزرار التفاعل (جام، جادور، ضحك)
reactionButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    const reaction = btn.getAttribute('data-reaction');

    let reactionsData = JSON.parse(localStorage.getItem('videoReactions')) || {};
    if (!reactionsData[currentVideoId]) {
      reactionsData[currentVideoId] = { like: 0, love: 0, laugh: 0 };
    }
    reactionsData[currentVideoId][reaction]++;

    saveData(reactionsData, JSON.parse(localStorage.getItem('videoComments')) || {});
    loadData();
  });
});

// تحميل البيانات أول مرة عند تحميل الصفحة
loadData();
