// تحديث الوقت والتاريخ باللغة العربية والفرنسية
function updateTime() {
  const now = new Date();
  const daysAr = ['الأحد', 'الإثنين', 'الثلاثاء', 'الأربعاء', 'الخميس', 'الجمعة', 'السبت'];
  const daysFr = ['dimanche', 'lundi', 'mardi', 'mercredi', 'jeudi', 'vendredi', 'samedi'];
  const monthsAr = ['جانفي', 'فيفري', 'مارس', 'أفريل', 'ماي', 'جوان', 'جويلية', 'أوت', 'سبتمبر', 'أكتوبر', 'نوفمبر', 'ديسمبر'];
  const monthsFr = ['janvier', 'février', 'mars', 'avril', 'mai', 'juin', 'juillet', 'août', 'septembre', 'octobre', 'novembre', 'décembre'];

  const lang = localStorage.getItem('lang') || 'ar';

  const dayName = lang === 'ar' ? daysAr[now.getDay()] : daysFr[now.getDay()];
  const monthName = lang === 'ar' ? monthsAr[now.getMonth()] : monthsFr[now.getMonth()];
  const date = now.getDate();
  const hours = now.getHours().toString().padStart(2,'0');
  const minutes = now.getMinutes().toString().padStart(2,'0');

  const timeString = lang === 'ar' ?
    `${dayName} ${date} ${monthName} - ${hours}:${minutes}` :
    `${dayName} ${date} ${monthName} - ${hours}h${minutes}`;

  document.getElementById('current-time').textContent = timeString;
}

// عداد الزيارات
function updateVisits() {
  let visits = localStorage.getItem('visit-count');
  visits = visits ? parseInt(visits) + 1 : 1;
  localStorage.setItem('visit-count', visits);
  const lang = localStorage.getItem('lang') || 'ar';
  const text = lang === 'ar' ? `عدد الزيارات: ${visits}` : `Visites: ${visits}`;
  document.getElementById('visit-count').textContent = text;
}

// جلب أخبار BBC عربية مع دعم اللغة
function fetchNews() {
  fetch('https://api.rss2json.com/v1/api.json?rss_url=http://feeds.bbci.co.uk/arabic/rss.xml')
    .then(res => res.json())
    .then(data => {
      const items = data.items.slice(0, 4);
      const lang = localStorage.getItem('lang') || 'ar';
      const newsText = items.map(item => `📰 ${item.title}`).join(' ⚡ ');
      document.getElementById('live-news').textContent = newsText;
    })
    .catch(() => {
      const lang = localStorage.getItem('lang') || 'ar';
      document.getElementById('live-news').textContent = lang === 'ar' ? '❌ فشل تحميل الأخبار.' : '❌ Échec du chargement des actualités.';
    });
}

// تبديل اللغة (عربي / فرنسي)
function toggleLang() {
  let currentLang = localStorage.getItem('lang') || 'ar';
  let newLang = currentLang === 'ar' ? 'fr' : 'ar';
  localStorage.setItem('lang', newLang);
  applyLang();
}

function applyLang() {
  let lang = localStorage.getItem('lang') || 'ar';
  document.documentElement.lang = lang;
  document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';
  document.querySelector('.lang-toggle').textContent = lang === 'ar' ? 'Français' : 'العربية';

  // تعيين النصوص الديناميكية حسب اللغة
  document.querySelectorAll('.t').forEach(el => {
    el.textContent = el.dataset[lang];
  });

  // العناوين الرئيسية
  const titles = {
    'title-services': {'ar': 'خدمات الورشة', 'fr': 'Nos Services'},
    'title-photos': {'ar': '📸 معرض الصور', 'fr': '📸 Galerie photos'},
    'title-videos': {'ar': '🎥 فيديوهات الورشة', 'fr': '🎥 Vidéos de l\'atelier'},
    'title-home': {'ar': 'Atelier Electronique Médenine', 'fr': 'Atelier Electronique Médenine'}
  };

  Object.keys(titles).forEach(id => {
    const el = document.getElementById(id);
    if(el) el.textContent = titles[id][lang];
  });

  // شريط الأخبار
  fetchNews();

  // تحديث الوقت والزيارات
  updateTime();
  updateVisits();
}

// تنفيذ التهيئة عند تحميل الصفحة
window.onload = () => {
  applyLang();
  setInterval(updateTime, 60000);
};
