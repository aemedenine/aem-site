const translations = { /* ...نفس الكائن كما عندك... */ };
let currentLang = "ar";

function getVisitCount() {
  return parseInt(localStorage.getItem("aem-visit-count")) || 0;
}

function incrementVisitCount() {
  let count = getVisitCount();
  count++;
  localStorage.setItem("aem-visit-count", count);
}

function updateLanguage() {
  console.log("تحديث اللغة إلى:", currentLang);
  const t = translations[currentLang];
  document.documentElement.lang = currentLang;
  document.documentElement.dir = currentLang === "ar" ? "rtl" : "ltr";

  document.getElementById("visit-count").textContent = t.visits + getVisitCount();
  document.getElementById("toggle-lang-btn").textContent = t.toggle;
  document.querySelector(".btn-whatsapp").textContent = t.whatsapp;
  document.querySelector(".btn-maps").textContent = t.maps;
  document.querySelector(".btn-gallery").textContent = t.gallery;
  document.querySelector(".btn-video").textContent = t.video;

  const radioBtn = document.getElementById("radio-btn");
  const radio = document.getElementById("radio-stream");
  radioBtn.textContent = radio.paused ? t.radioPlay : t.radioStop;

  document.querySelector(".experience-badge").textContent = t.badge;

  document.querySelector(".faq h2").textContent = t.faqTitle;
  const questions = document.querySelectorAll(".faq-item h3");
  const answers = document.querySelectorAll(".faq-item .answer");
  questions[0].textContent = t.q1;
  answers[0].textContent = t.a1;
  questions[1].textContent = t.q2;
  answers[1].textContent = t.a2;
  questions[2].textContent = t.q3;
  answers[2].textContent = t.a3;
  questions[3].textContent = t.q4;
  answers[3].textContent = t.a4;

  document.querySelector("footer p:nth-of-type(1)").textContent = t.footer1;
  document.querySelector("footer p:nth-of-type(2)").textContent = t.footer2;

  updateNews();
}

function updateTime() {
  const now = new Date();
  const days = {
    ar: ['الأحد','الإثنين','الثلاثاء','الأربعاء','الخميس','الجمعة','السبت'],
    fr: ['Dimanche','Lundi','Mardi','Mercredi','Jeudi','Vendredi','Samedi'],
    en: ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday']
  };
  const months = {
    ar: ['جانفي','فيفري','مارس','أفريل','ماي','جوان','جويلية','أوت','سبتمبر','أكتوبر','نوفمبر','ديسمبر'],
    fr: ['Janvier','Février','Mars','Avril','Mai','Juin','Juillet','Août','Septembre','Octobre','Novembre','Décembre'],
    en: ['January','February','March','April','May','June','July','August','September','October','November','December']
  };

  const dayName = days[currentLang][now.getDay()];
  const monthName = months[currentLang][now.getMonth()];
  const dateNum = now.getDate();

  const hours = now.getHours().toString().padStart(2,'0');
  const minutes = now.getMinutes().toString().padStart(2,'0');
  const seconds = now.getSeconds().toString().padStart(2,'0');

  const dateStr = currentLang === "ar" ? `${dayName}، ${dateNum} ${monthName}` : `${dayName}, ${dateNum} ${monthName}`;
  const timeStr = `${hours}:${minutes}:${seconds}`;

  document.getElementById("current-time").textContent = `${dateStr} - ${timeStr}`;
}

function updateNews() {
  const newsArea = document.getElementById("live-news");
  const newsItems = translations[currentLang].news;
  newsArea.textContent = newsItems.join(" • ");
}

function initFAQ() {
  const items = document.querySelectorAll('.faq-item');
  items.forEach(item => {
    item.onclick = () => {
      item.classList.toggle('open');
    };
  });
}

document.addEventListener('DOMContentLoaded', () => {
  incrementVisitCount();
  updateLanguage();
  updateTime();
  initFAQ();

  setInterval(updateTime, 1000);

  document.getElementById("toggle-lang-btn").addEventListener("click", () => {
    if(currentLang === "ar") currentLang = "fr";
    else if(currentLang === "fr") currentLang = "en";
    else currentLang = "ar";
    updateLanguage();
  });

  const radio = document.getElementById("radio-stream");
  const radioBtn = document.getElementById("radio-btn");
  radioBtn.addEventListener("click", () => {
    if(radio.paused) {
      radio.play();
      radioBtn.textContent = translations[currentLang].radioStop;
    } else {
      radio.pause();
      radioBtn.textContent = translations[currentLang].radioPlay;
    }
  });
});
